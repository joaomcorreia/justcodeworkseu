{% load static %}
{% load business_filters %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>Chat with Clippy 2.0 - {{ project.business_name|default:"New Project" }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Updated Layout - 2025-10-10 */
        .chat-container {
            height: 50vh !important;
            display: flex;
            flex-direction: column;
        }

        /* Force proper column layout - ALWAYS side by side - MAIN ROW ONLY */
        .container-fluid>.row {
            display: flex !important;
            flex-wrap: nowrap !important;
        }

        .col-sm-5,
        .col-md-5,
        .col-lg-4 {
            flex: 0 0 30% !important;
            max-width: 30% !important;
        }

        .col-sm-7,
        .col-md-7,
        .col-lg-8 {
            flex: 0 0 70% !important;
            max-width: 70% !important;
        }

        /* Prevent column stacking on any screen size */
        @media (min-width: 576px) {
            .col-sm-5 {
                flex: 0 0 30% !important;
                max-width: 30% !important;
            }

            .col-sm-7 {
                flex: 0 0 70% !important;
                max-width: 70% !important;
            }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .message {
            margin-bottom: 1rem;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-clippy {
            display: flex;
            justify-content: flex-start;
        }

        .message-user {
            display: flex;
            justify-content: flex-end;
        }

        .message-content {
            max-width: 85%;
            padding: 0.5rem 0.75rem;
            border-radius: 12px;
            position: relative;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .message-clippy .message-content {
            background: white;
            border: 1px solid #007bff;
            margin-left: 0;
        }

        .message-user .message-content {
            background: #007bff;
            color: white;
            margin-right: 0;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            margin: 0 0.4rem;
        }

        .avatar-clippy {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .avatar-user {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
        }

        .chat-input-area {
            padding: 1rem 0;
            border-top: 1px solid #dee2e6;
            background: white;
        }

        .progress-bar-custom {
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #007bff, #28a745);
        }

        .step-indicator {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .typing-indicator {
            display: none;
            padding: 0.5rem 1rem;
            background: #f1f3f4;
            border-radius: 18px;
            margin-left: 3rem;
        }

        .typing-dots {
            display: inline-block;
        }

        .typing-dots span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6c757d;
            margin: 0 2px;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typing {

            0%,
            80%,
            100% {
                transform: scale(0.8);
                opacity: 0.5;
            }

            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .project-info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        /* Services Section Styles */
        .service-card:hover {
            transform: translateY(-10px);
            border-color: #667eea !important;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3) !important;
        }

        .service-card:hover .service-icon {
            transform: scale(1.1);
        }

        .service-icon {
            transition: transform 0.3s ease;
        }

        /* Live Preview Styles */
        .preview-header-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .preview-header-card .card-body {
            padding: 2rem;
        }

        .preview-header-card h5 {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .preview-card {
            border: 1px solid #e3e6f0;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
            height: calc(100vh - 220px);
            min-height: 600px;
        }

        .preview-container {
            position: relative;
            height: 300px; /* Reduced height for better layout */
            background: #f8f9fa;
        }

        .preview-frame {
            width: 100%;
            height: 300px; /* Reduced height for better layout */
            border: none;
            background: white;
            transition: all 0.3s ease;
        }

        /* Step Indicators */
        .step-indicator {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .step-indicator.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .step-indicator.inactive {
            background: #e9ecef;
            color: #6c757d;
        }

        .preview-frame.mobile-view {
            width: 375px;
            height: 667px;
            margin: 20px auto;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 8px solid #333;
        }

        .preview-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .placeholder-content {
            text-align: center;
            max-width: 300px;
        }

        .preview-steps {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            min-width: 60px;
            font-size: 0.8rem;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .step.active {
            background: #007bff;
            color: white;
            transform: scale(1.05);
        }

        .step.completed {
            background: #28a745;
            color: white;
        }

        .preview-controls .btn {
            margin-left: 5px;
        }

        .preview-controls .btn.active {
            background-color: #007bff;
            color: white;
        }

        /* Checkbox alignment fixes */
        .services-selection .form-check {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-left: 0;
        }

        .services-selection .form-check-input {
            margin-right: 0.5rem;
            margin-top: 0;
            flex-shrink: 0;
        }

        .services-selection .form-check-label {
            margin-bottom: 0;
            line-height: 1.2;
            padding-top: 1px;
        }

        /* Template selection styles */
        .template-selection .template-card {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            overflow: hidden;
        }

        .template-selection .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 123, 255, 0.3);
            border-color: #007bff;
        }

        .template-selection .template-image-container {
            position: relative;
            overflow: hidden;
        }

        .template-selection .template-preview {
            height: 180px;
            width: 100%;
            object-fit: cover;
            border-bottom: 1px solid #dee2e6;
            transition: transform 0.3s ease;
        }

        .template-selection .template-card:hover .template-preview {
            transform: scale(1.05);
        }

        .template-selection .template-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 123, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .template-selection .template-card:hover .template-overlay {
            opacity: 1;
        }

        .template-selection .template-overlay-content {
            text-align: center;
            color: white;
        }

        .template-selection .template-overlay-content i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .template-selection .card-title {
            color: #007bff;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .template-selection .card-text {
            font-size: 0.8rem;
            line-height: 1.3;
            color: #6c757d;
        }

        .template-selection .template-stats {
            margin-top: 0.5rem;
        }

        .template-selection-help {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .template-selection .card-footer {
            padding: 0.75rem;
        }

        .template-selection .btn-sm {
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
        }

        /* Single template showcase styles */
        .template-showcase .template-card-single {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .template-showcase .template-card-single:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 123, 255, 0.2);
            border-color: #007bff;
        }

        .template-showcase .template-preview-large {
            height: 250px;
            width: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .template-showcase .template-card-single:hover .template-preview-large {
            transform: scale(1.05);
        }

        .template-showcase .template-features {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
        }

        .template-showcase .template-features i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .template-showcase .card-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .template-showcase .btn-lg {
            border-radius: 50px;
            padding: 12px 20px;
            font-weight: 600;
        }

        footer {
            margin-top: 40px;
            border-top: 1px solid #b9b9b9;
            padding: 20px 0;
            background: #f8f9fa;
            text-align: center;
            font-size: 0.9rem;
            color: #6c757d;
        }
    </style>
</head>

<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand fw-bold" href="{% url 'website_builder:dashboard' %}">
                <i class="fas fa-arrow-left me-2"></i>Website Builder
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">Building: {{ project.business_name|default:"New Website" }}</span>
            </div>
        </div>
    </nav>
    <div class="container-fluid mt-5">
        <div class="row">
            <!-- Live Website Preview - Left Column -->
            <div class="col-sm-7 col-md-7 col-lg-8">
                <!-- Preview Controls Header -->
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center bg-light">
                        <div>
                            <i class="fas fa-globe me-2"></i>
                            <span id="previewTitle">{{ project.business_name|default:"Your Website" }} Preview</span>
                        </div>
                        <div class="preview-controls">
                            <button class="btn btn-sm btn-outline-primary" onclick="togglePreviewDevice('desktop')"
                                id="desktopBtn">
                                <i class="fas fa-desktop"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="togglePreviewDevice('mobile')"
                                id="mobileBtn">
                                <i class="fas fa-mobile-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Website Preview Frame -->
                <div class="card preview-card">
                    <!-- Actual Website Header -->
                    <div class="card-body bg-white p-0" style="box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="padding: 1rem 0;">
                            <div class="container-fluid">
                                <nav class="d-flex justify-content-between align-items-center">
                                    <div class="logo" style="font-size: 1.5rem; font-weight: bold; color: #007bff;">
                                        {{ project.business_name|default:"Your Business" }}
                                    </div>
                                    <ul class="nav d-none d-md-flex" style="list-style: none; margin: 0; padding: 0;">
                                        <li style="margin: 0 15px;"><a href="javascript:void(0)" onclick="scrollToSection('home')"
                                                style="text-decoration: none; color: #333; font-weight: 500; cursor: pointer;">Home</a>
                                        </li>
                                        <li style="margin: 0 15px;"><a href="javascript:void(0)" onclick="scrollToSection('services')"
                                                style="text-decoration: none; color: #333; font-weight: 500; cursor: pointer;">Services</a>
                                        </li>
                                        <li style="margin: 0 15px;"><a href="javascript:void(0)" onclick="scrollToSection('about')"
                                                style="text-decoration: none; color: #333; font-weight: 500; cursor: pointer;">About</a>
                                        </li>
                                        <li style="margin: 0 15px;"><a href="javascript:void(0)" onclick="scrollToSection('contact')"
                                                style="text-decoration: none; color: #333; font-weight: 500; cursor: pointer;">Contact</a>
                                        </li>
                                    </ul>
                                    <div class="d-md-none">
                                        <button class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-bars"></i>
                                        </button>
                                    </div>
                                </nav>
                            </div>
                        </div>
                    </div>

                    <!-- Hero/Slideshow Section -->
                    <div id="home"
                        style="height: 600px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); position: relative; display: flex; align-items: center; justify-content: center;">
                        <div class="text-center text-white">
                            <div
                                style="background: rgba(255,255,255,0.1); padding: 3rem; border-radius: 15px; backdrop-filter: blur(10px);">
                                <i class="fas fa-images fa-4x mb-3" style="opacity: 0.8;"></i>
                                <h2 style="font-size: 2.5rem; margin-bottom: 1rem; font-weight: 300;">Hero Slideshow
                                </h2>
                                <p style="font-size: 1.2rem; margin-bottom: 2rem; opacity: 0.9;">Dynamic content will be
                                    displayed here</p>
                                <div class="d-flex justify-content-center gap-2">
                                    <div
                                        style="width: 12px; height: 12px; background: rgba(255,255,255,0.7); border-radius: 50%;">
                                    </div>
                                    <div style="width: 12px; height: 12px; background: white; border-radius: 50%;">
                                    </div>
                                    <div
                                        style="width: 12px; height: 12px; background: rgba(255,255,255,0.7); border-radius: 50%;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Slideshow navigation arrows -->
                        <div
                            style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: white; font-size: 2rem; opacity: 0.7;">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div
                            style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: white; font-size: 2rem; opacity: 0.7;">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>

                    <!-- Services Section for Portfolio & Creative -->
                    <div class="card-body bg-white p-0" id="services" style="display: block;">
                        <div style="padding: 4rem 0; background: #f8f9fa;">
                            <div class="container-fluid">
                                <div class="text-center mb-5">
                                    <h2 style="font-size: 2.5rem; margin-bottom: 1rem; color: #333; font-weight: 600;">Our Creative Services</h2>
                                    <p style="font-size: 1.2rem; color: #666; max-width: 600px; margin: 0 auto;">Transform your vision into stunning visual reality with our professional creative services</p>
                                </div>
                                
                                <div id="servicesGrid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; width: 100%;">
                                    <!-- Service Card 1 - Graphic Design -->
                                    <div style="width: 100%;">
                                        <div class="service-card" style="background: white; padding: 1.5rem; border-radius: 15px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border: 2px solid transparent; transition: all 0.3s ease; height: 100%;">
                                            <div class="service-icon" style="width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem;">
                                                <i class="fas fa-palette"></i>
                                            </div>
                                            <h5 style="color: #333; margin-bottom: 0.8rem; font-weight: 600; font-size: 1.1rem;">Graphic Design</h5>
                                            <p style="color: #666; font-size: 0.9rem; line-height: 1.5; margin-bottom: 0;">Logo design, branding, print materials, and digital graphics</p>
                                        </div>
                                    </div>

                                    <!-- Service Card 2 - Web Design -->
                                    <div style="width: 100%;">
                                        <div class="service-card" style="background: white; padding: 1.5rem; border-radius: 15px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border: 2px solid transparent; transition: all 0.3s ease; height: 100%;">
                                            <div class="service-icon" style="width: 60px; height: 60px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem;">
                                                <i class="fas fa-globe"></i>
                                            </div>
                                            <h5 style="color: #333; margin-bottom: 0.8rem; font-weight: 600; font-size: 1.1rem;">Web Design & Development</h5>
                                            <p style="color: #666; font-size: 0.9rem; line-height: 1.5; margin-bottom: 0;">Custom websites, UI/UX design, and responsive layouts</p>
                                        </div>
                                    </div>

                                    <!-- Service Card 3 - Photography -->
                                    <div style="width: 100%;">
                                        <div class="service-card" style="background: white; padding: 1.5rem; border-radius: 15px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border: 2px solid transparent; transition: all 0.3s ease; height: 100%;">
                                            <div class="service-icon" style="width: 60px; height: 60px; background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem;">
                                                <i class="fas fa-camera"></i>
                                            </div>
                                            <h5 style="color: #333; margin-bottom: 0.8rem; font-weight: 600; font-size: 1.1rem;">Photography</h5>
                                            <p style="color: #666; font-size: 0.9rem; line-height: 1.5; margin-bottom: 0;">Portrait, commercial, event, and product photography</p>
                                        </div>
                                    </div>

                                    <!-- Service Card 4 - Video Production -->
                                    <div style="width: 100%;">
                                        <div class="service-card" style="background: white; padding: 1.5rem; border-radius: 15px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border: 2px solid transparent; transition: all 0.3s ease; height: 100%;">
                                            <div class="service-icon" style="width: 60px; height: 60px; background: linear-gradient(135deg, #dc3545 0%, #e91e63 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem;">
                                                <i class="fas fa-video"></i>
                                            </div>
                                            <h5 style="color: #333; margin-bottom: 0.8rem; font-weight: 600; font-size: 1.1rem;">Video Production</h5>
                                            <p style="color: #666; font-size: 0.9rem; line-height: 1.5; margin-bottom: 0;">Promotional videos, editing, animation, and motion graphics</p>
                                        </div>
                                    </div>

                                    <!-- Service Card 5 - Brand Identity -->
                                    <div style="width: 100%;">
                                        <div class="service-card" style="background: white; padding: 1.5rem; border-radius: 15px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border: 2px solid transparent; transition: all 0.3s ease; height: 100%;">
                                            <div class="service-icon" style="width: 60px; height: 60px; background: linear-gradient(135deg, #6f42c1 0%, #495057 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem;">
                                                <i class="fas fa-award"></i>
                                            </div>
                                            <h5 style="color: #333; margin-bottom: 0.8rem; font-weight: 600; font-size: 1.1rem;">Brand Identity Design</h5>
                                            <p style="color: #666; font-size: 0.9rem; line-height: 1.5; margin-bottom: 0;">Complete branding packages, style guides, and corporate identity</p>
                                        </div>
                                    </div>

                                    <!-- Service Card 6 - Creative Consultation -->
                                    <div style="width: 100%;">
                                        <div class="service-card" style="background: white; padding: 1.5rem; border-radius: 15px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border: 2px solid transparent; transition: all 0.3s ease; height: 100%;">
                                            <div class="service-icon" style="width: 60px; height: 60px; background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem;">
                                                <i class="fas fa-lightbulb"></i>
                                            </div>
                                            <h5 style="color: #333; margin-bottom: 0.8rem; font-weight: 600; font-size: 1.1rem;">Creative Consultation</h5>
                                            <p style="color: #666; font-size: 0.9rem; line-height: 1.5; margin-bottom: 0;">Creative direction, concept development, and visual strategy</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- About Us Section -->
                    <div class="card-body bg-white p-0" id="about">
                        <div style="padding: 4rem 0; background: #ffffff;">
                            <div class="container-fluid">
                                <div class="row align-items-center">
                                    <!-- About Content - Left Side -->
                                    <div class="col-md-6">
                                        <div style="padding-right: 2rem;">
                                            <h2 style="font-size: 2.5rem; margin-bottom: 1.5rem; color: #333; font-weight: 600;" id="aboutTitle">About Our Company</h2>
                                            <p style="font-size: 1.1rem; color: #666; line-height: 1.7; margin-bottom: 1.5rem;" id="aboutDescription">
                                                We are a professional business dedicated to providing exceptional services to our clients. With years of experience in our industry, we have built a reputation for quality, reliability, and customer satisfaction.
                                            </p>
                                            <p style="font-size: 1.1rem; color: #666; line-height: 1.7; margin-bottom: 2rem;" id="aboutMission">
                                                Our mission is to deliver outstanding results that exceed expectations while maintaining the highest standards of professionalism and integrity in everything we do.
                                            </p>
                                            <div class="row" style="margin-bottom: 2rem;">
                                                <div class="col-6">
                                                    <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 10px;">
                                                        <h3 style="color: #007bff; font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;" id="aboutYears">10+</h3>
                                                        <p style="color: #666; font-size: 0.9rem; margin: 0;">Years Experience</p>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 10px;">
                                                        <h3 style="color: #28a745; font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;" id="aboutClients">500+</h3>
                                                        <p style="color: #666; font-size: 0.9rem; margin: 0;">Happy Clients</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                <a href="#contact" style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); color: white; padding: 12px 30px; border-radius: 25px; text-decoration: none; font-weight: 600; display: inline-block; transition: transform 0.3s ease;">
                                                    Learn More About Us
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- About Image - Right Side -->
                                    <div class="col-md-6">
                                        <div style="text-align: center; padding-left: 2rem;">
                                            <div style="position: relative; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 20px; padding: 3rem; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                                                <!-- Placeholder for business image -->
                                                <div id="aboutImageContainer" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 300px; border-radius: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                                                    <div style="text-align: center;">
                                                        <i class="fas fa-building fa-3x" style="margin-bottom: 1rem; opacity: 0.8;" id="aboutIcon"></i>
                                                        <p style="margin: 0; font-weight: 500;" id="aboutImageText">Your Business</p>
                                                        <p style="margin: 0.5rem 0 0; font-size: 1rem; opacity: 0.9;">Professional Excellence</p>
                                                    </div>
                                                </div>
                                                
                                                <!-- Decorative elements -->
                                                <div style="position: absolute; top: -10px; right: -10px; width: 60px; height: 60px; background: #ffc107; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                                    <i class="fas fa-star" style="color: white; font-size: 1.5rem;"></i>
                                                </div>
                                                <div style="position: absolute; bottom: -15px; left: -15px; width: 40px; height: 40px; background: #28a745; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                                    <i class="fas fa-check" style="color: white; font-size: 1rem;"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Section -->
                    <div class="card-body bg-white p-0" id="contact" style="display: block;">
                        <div style="padding: 4rem 0; background: #f8f9fa;">
                            <div class="container-fluid">
                                <div class="row justify-content-center">
                                    <div class="col-12 text-center mb-5">
                                        <h2 style="font-size: 2.5rem; margin-bottom: 1rem; color: #333; font-weight: 600;" id="contactTitle">Get In Touch</h2>
                                        <p style="font-size: 1.1rem; color: #666;" id="contactSubtitle">Ready to work with us? Contact us today!</p>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <!-- Contact Form -->
                                    <div class="col-md-6 mb-4">
                                        <div style="background: white; border-radius: 15px; padding: 2rem; box-shadow: 0 5px 20px rgba(0,0,0,0.1); height: 100%;">
                                            <h4 style="color: #333; margin-bottom: 1.5rem; font-weight: 600;" id="formTitle">Send us a Message</h4>
                                            <form id="contactForm">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label style="color: #555; font-weight: 500; margin-bottom: 0.5rem;">First Name</label>
                                                        <input type="text" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;" required>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label style="color: #555; font-weight: 500; margin-bottom: 0.5rem;">Last Name</label>
                                                        <input type="text" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;" required>
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <label style="color: #555; font-weight: 500; margin-bottom: 0.5rem;">Email Address</label>
                                                    <input type="email" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label style="color: #555; font-weight: 500; margin-bottom: 0.5rem;">Phone Number</label>
                                                    <input type="tel" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                                </div>
                                                <div class="mb-3">
                                                    <label style="color: #555; font-weight: 500; margin-bottom: 0.5rem;" id="serviceLabel">Service Needed</label>
                                                    <select style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                                        <option value="">Select a service...</option>
                                                        <option value="consultation" id="serviceOption1">Consultation</option>
                                                        <option value="quote" id="serviceOption2">Free Quote</option>
                                                        <option value="emergency" id="serviceOption3">Emergency Service</option>
                                                    </select>
                                                </div>
                                                <div class="mb-4">
                                                    <label style="color: #555; font-weight: 500; margin-bottom: 0.5rem;">Message</label>
                                                    <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; resize: vertical;" rows="4" placeholder="Tell us about your project or needs..." required></textarea>
                                                </div>
                                                <button type="submit" style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); color: white; padding: 12px 30px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; width: 100%; cursor: pointer; transition: transform 0.3s ease;">
                                                    <i class="fas fa-paper-plane" style="margin-right: 0.5rem;"></i>Send Message
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                    
                                    <!-- Contact Info & Map -->
                                    <div class="col-md-6 mb-4">
                                        <div style="background: white; border-radius: 15px; padding: 2rem; box-shadow: 0 5px 20px rgba(0,0,0,0.1); height: 100%;">
                                            <h4 style="color: #333; margin-bottom: 1.5rem; font-weight: 600;">Contact Information</h4>
                                            
                                            <!-- Contact Details -->
                                            <div style="margin-bottom: 2rem;">
                                                <div style="display: flex; align-items: center; margin-bottom: 1rem; padding: 0.75rem; background: #f8f9fa; border-radius: 8px;">
                                                    <div style="margin-right: 1rem; color: #007bff;">
                                                        <i class="fas fa-map-marker-alt" style="font-size: 1.2rem;"></i>
                                                    </div>
                                                    <div>
                                                        <strong style="color: #333;">Address</strong><br>
                                                        <span style="color: #666;" id="businessAddress">123 Business Street<br>City, State 12345</span>
                                                    </div>
                                                </div>
                                                
                                                <div style="display: flex; align-items: center; margin-bottom: 1rem; padding: 0.75rem; background: #f8f9fa; border-radius: 8px;">
                                                    <div style="margin-right: 1rem; color: #007bff;">
                                                        <i class="fas fa-phone" style="font-size: 1.2rem;"></i>
                                                    </div>
                                                    <div>
                                                        <strong style="color: #333;">Phone</strong><br>
                                                        <span style="color: #666;" id="businessPhone">(555) 123-4567</span>
                                                    </div>
                                                </div>
                                                
                                                <div style="display: flex; align-items: center; margin-bottom: 1rem; padding: 0.75rem; background: #f8f9fa; border-radius: 8px;">
                                                    <div style="margin-right: 1rem; color: #007bff;">
                                                        <i class="fas fa-envelope" style="font-size: 1.2rem;"></i>
                                                    </div>
                                                    <div>
                                                        <strong style="color: #333;">Email</strong><br>
                                                        <span style="color: #666;" id="businessEmail">info@business.com</span>
                                                    </div>
                                                </div>

                                                <div style="display: flex; align-items: center; margin-bottom: 1rem; padding: 0.75rem; background: #f8f9fa; border-radius: 8px;">
                                                    <div style="margin-right: 1rem; color: #28a745;">
                                                        <i class="fab fa-whatsapp" style="font-size: 1.2rem;"></i>
                                                    </div>
                                                    <div>
                                                        <strong style="color: #333;">WhatsApp</strong><br>
                                                        <span style="color: #666;" id="businessWhatsApp">+1 (555) 123-4567</span>
                                                    </div>
                                                </div>
                                                
                                                <div style="display: flex; align-items: center; margin-bottom: 1.5rem; padding: 0.75rem; background: #f8f9fa; border-radius: 8px;">
                                                    <div style="margin-right: 1rem; color: #007bff;">
                                                        <i class="fas fa-clock" style="font-size: 1.2rem;"></i>
                                                    </div>
                                                    <div>
                                                        <strong style="color: #333;">Hours</strong><br>
                                                        <span style="color: #666;" id="businessHours">Mon-Fri: 9:00 AM - 6:00 PM<br>Sat: 9:00 AM - 4:00 PM</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Map Container -->
                                            <div>
                                                <h5 style="color: #333; margin-bottom: 1rem; font-weight: 600;">Find Us Here</h5>
                                                <div id="mapContainer" style="height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden;">
                                                    <div style="text-align: center; color: white;">
                                                        <i class="fas fa-map-marked-alt" style="font-size: 2.5rem; margin-bottom: 0.5rem; opacity: 0.9;"></i>
                                                        <h6 id="mapTitle" style="margin: 0; font-weight: 600;">Interactive Map</h6>
                                                        <p id="mapAddress" style="margin: 0.25rem 0 0; font-size: 0.9rem; opacity: 0.8;">123 Business Street, City, State</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card-body p-0">
                        <div id="websitePreviewContainer" class="preview-container">
                            <!-- Real-time website preview will be rendered here -->
                            <iframe id="websitePreviewFrame" src="{% if project.template_id %}{% url 'website_builder:template_preview' project.template_id %}{% else %}{% url 'website_builder:template_preview' 'jcw-tpl00' %}{% endif %}" class="preview-frame" frameborder="0">
                            </iframe>

                            <!-- Preview placeholder when no content -->
                            <div id="previewPlaceholder" class="preview-placeholder">
                                <div class="placeholder-content text-center">
                                    <i class="fas fa-globe fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">Website Preview</h5>
                                    <p class="text-muted mb-0">Your website will appear here as we build it together!
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Preview Controls -->
                        <div class="text-center mt-2 mb-3">
                            <button class="btn btn-outline-secondary btn-sm" onclick="scrollToFooterInPreview()">
                                <i class="fas fa-arrow-down me-1"></i>Scroll to Footer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Area - Right Column -->
            <div class="col-sm-5 col-md-5 col-lg-4">
                <!-- Business Details Tables -->
                <div class="row mb-4">
                    <!-- Project Information - Full Width -->
                    <div class="col-12 mb-3">
                        <div class="card h-100">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-building me-2"></i>Project Information</h6>
                                <button type="button" class="btn btn-sm btn-outline-primary" 
                                        data-bs-toggle="modal" data-bs-target="#websiteBuilderModal"
                                        title="Edit Business Details">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm table-borderless mb-0">
                                    <tr>
                                        <td class="fw-bold" style="width: 30%;">Business Name:</td>
                                        <td id="projectBusinessName">{{ project.business_name|default:"Not specified" }}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Phone:</td>
                                        <td id="projectPhoneNumber">{{ conversation_data.phone_number|default:project.phone|default:"Not specified" }}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Email:</td>
                                        <td id="projectBusinessEmail">{{ project.business_email|default:"Not specified" }}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">WhatsApp:</td>
                                        <td id="projectWhatsappNumber">{{ project.whatsapp_number|default:"Not specified" }}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Opening Times:</td>
                                        <td id="projectOpeningTimes">{{ project.opening_times|default:"Not specified"|truncatewords:5 }}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Address:</td>
                                        <td id="projectBusinessAddress">{{ project.business_address|default:"Not specified" }}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Business Type:</td>
                                        <td id="projectBusinessType">{{ conversation_data.business_type|default:project.industry|format_business_type }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Building Steps - Right Half -->
                    <div class="col-6 mb-3">
                        <!-- <div class="card h-100">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-tasks me-2"></i>Building Steps</h6>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div
                                            class="step-indicator {% if conversation.current_step == 'template_selection' %}active{% else %}inactive{% endif %}">
                                            <i class="fas fa-palette"></i>
                                        </div>
                                        <small>Template</small>
                                    </div>
                                    <div class="col-4">
                                        <div
                                            class="step-indicator {% if conversation.current_step == 'content_generation' %}active{% else %}inactive{% endif %}">
                                            <i class="fas fa-file-alt"></i>
                                        </div>
                                        <small>Content</small>
                                    </div>
                                    <div class="col-4">
                                        <div
                                            class="step-indicator {% if conversation.current_step == 'final_review' %}active{% else %}inactive{% endif %}">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <small>Review</small>
                                    </div>
                                </div>
                            </div>
                        </div> -->
                    </div>
                </div>
                <!-- Progress Header - Compact -->
                <div class="card mb-3">
                    <div class="card-body py-2">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <h6 class="mb-0">
                                <i class="fas fa-robot me-1 text-primary"></i>
                                Clippy 2.0
                            </h6>
                            <span class="badge bg-primary text-xs">{{ current_step|title }}</span>
                        </div>
                        <div class="progress mb-1" style="height: 4px;">
                            <div class="progress-bar progress-bar-custom" role="progressbar"
                                style="width: {{ progress }}%" aria-valuenow="{{ progress }}" aria-valuemin="0"
                                aria-valuemax="100">
                            </div>
                        </div>
                        <small class="text-muted">{{ progress }}% • {{ conversation.current_step|title }}</small>
                    </div>
                </div>

                <!-- Chat Interface -->
                <div class="card">
                    <div class="chat-container">
                        <!-- Messages Area -->
                        <div class="chat-messages" id="chatMessages">
                            <!-- Initial message from Clippy -->
                            {% if initial_message %}
                            <div class="message message-clippy">
                                <div class="message-avatar avatar-clippy">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="message-content">
                                    <strong>Clippy 2.0:</strong><br>
                                    {{ initial_message|linebreaksbr }}
                                </div>
                            </div>
                            {% else %}
                            <!-- Default welcome message -->
                            <div class="message message-clippy">
                                <div class="message-avatar avatar-clippy">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="message-content">
                                    <strong>Clippy 2.0:</strong><br>
                                    Hello! 👋 I'm Clippy, your AI website builder assistant and I am going to help you build a great website.
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Typing indicator (hidden by default) -->
                            <div class="typing-indicator" id="typingIndicator">
                                <div class="typing-dots">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                                <span class="ms-2">Clippy is typing...</span>
                            </div>
                        </div>

                        <!-- Input Area -->
                        <div class="chat-input-area">
                            <form id="chatForm" class="d-flex">
                                <input type="text" class="form-control me-2" id="messageInput"
                                    placeholder="Type your message..." autocomplete="off">
                                <button type="submit" class="btn btn-primary btn-sm" id="sendBtn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <!-- Business Details Modal -->
    {% include 'website_builder/includes/business_details_modal.html' %}
    
    <footer> Here stays the footer </footer>
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const chatMessages = document.getElementById('chatMessages');
        const chatForm = document.getElementById('chatForm');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const projectId = '{{ project.project_id }}';

        // Focus on input
        messageInput.focus();

        // Handle form submission
        chatForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const message = messageInput.value.trim();
            if (!message) return;

            // Add user message to chat
            addMessage(message, 'user');

            // Clear input and disable form
            messageInput.value = '';
            sendBtn.disabled = true;
            messageInput.disabled = true;

            // Show typing indicator
            showTypingIndicator();

            // Send message to API
            sendMessage(message);
        });

        function addMessage(content, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${sender}`;

            const avatar = sender === 'clippy' ?
                '<div class="message-avatar avatar-clippy"><i class="fas fa-robot"></i></div>' :
                '<div class="message-avatar avatar-user"><i class="fas fa-user"></i></div>';

            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';

            if (sender === 'clippy') {
                messageContent.innerHTML = `<strong>Clippy 2.0:</strong><br>${formatClippyMessage(content)}`;
                messageDiv.innerHTML = avatar;
                messageDiv.appendChild(messageContent);
            } else {
                messageContent.innerHTML = content;
                messageDiv.appendChild(messageContent);
                messageDiv.innerHTML += avatar;
            }

            chatMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        function formatClippyMessage(content) {
            // Format Clippy's messages with proper HTML
            return content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')  // Bold text
                .replace(/\*(.*?)\*/g, '<em>$1</em>')              // Italic text
                .replace(/\n/g, '<br>')                            // Line breaks
                .replace(/•/g, '•')                                // Bullet points
                .replace(/✅/g, '✅')                              // Checkmarks
                .replace(/🎉/g, '🎉')                              // Celebrations
                .replace(/🤖/g, '🤖')                              // Robot emoji
                .replace(/✨/g, '✨');                              // Sparkles
        }

        function showTypingIndicator() {
            typingIndicator.style.display = 'block';
            scrollToBottom();
        }

        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function sendMessage(message) {
            // Get CSRF token from meta tag or cookie
            const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || getCookie('csrftoken');

            console.log('Sending message:', message);
            console.log('CSRF token:', csrfToken);

            fetch(`{% url 'website_builder:chat_api' project.project_id %}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({
                    message: message
                })
            })
                .then(response => {
                    console.log('Response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('Response data:', data);
                    hideTypingIndicator();

                    if (data.success) {
                        // Add Clippy's response
                        addMessage(data.message, 'clippy');

                        // Update project info if provided
                        updateProjectInfo(data.project_data);

                        // Update live preview with new project data
                        if (data.project_data) {
                            updateLivePreview(data.project_data, data.template_data || {});
                            updatePreviewStep(data.current_step || 'business_info');
                        }

                        // Update progress
                        if (data.progress !== undefined) {
                            updateProgress(data.progress, data.current_step);
                        }
                    } else {
                        addMessage(data.message || 'Sorry, I encountered an error. Please try again.', 'clippy');
                    }
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                    hideTypingIndicator();
                    addMessage(`Sorry, I encountered a connection error: ${error.message}. Please try again.`, 'clippy');
                })
                .finally(() => {
                    // Re-enable form
                    sendBtn.disabled = false;
                    messageInput.disabled = false;
                    messageInput.focus();
                });
        }

        function updateProjectInfo(projectData) {
            if (!projectData) return;

            // Update Business Name
            if (projectData.business_name) {
                const businessNameElement = document.getElementById('projectBusinessName');
                if (businessNameElement) {
                    businessNameElement.textContent = projectData.business_name;
                }
            }
            
            // Update Phone Number
            if (projectData.phone_number) {
                const phoneElement = document.getElementById('projectPhoneNumber');
                if (phoneElement) {
                    phoneElement.textContent = projectData.phone_number;
                }
            }

            // Update Business Email
            if (projectData.business_email) {
                const emailElement = document.getElementById('projectBusinessEmail');
                if (emailElement) {
                    emailElement.textContent = projectData.business_email;
                }
            }

            // Update WhatsApp Number
            if (projectData.whatsapp_number) {
                const whatsappElement = document.getElementById('projectWhatsappNumber');
                if (whatsappElement) {
                    whatsappElement.textContent = projectData.whatsapp_number;
                }
            }

            // Update Opening Times
            if (projectData.opening_times) {
                const openingTimesElement = document.getElementById('projectOpeningTimes');
                if (openingTimesElement) {
                    // Truncate to first few words for table display
                    const truncated = projectData.opening_times.split(' ').slice(0, 5).join(' ') + 
                                    (projectData.opening_times.split(' ').length > 5 ? '...' : '');
                    openingTimesElement.textContent = truncated;
                }
            }
            
            // Update Business Address
            if (projectData.business_address) {
                document.getElementById('projectBusinessAddress').textContent = projectData.business_address;
            }
            
            // Update Business Type
            if (projectData.business_type) {
                // Convert business type value to display text
                const businessTypeMap = {
                    'construction': '🏗️ Construction & Contracting',
                    'automotive': '🚗 Automotive & Repair',
                    'plumbing': '🔧 Plumbing & HVAC',
                    'electrical': '⚡ Electrical Services',
                    'cleaning': '🧹 Cleaning Services',
                    'landscaping': '🌿 Landscaping & Gardening',
                    'home_services': '🏠 Home Services',
                    'legal': '⚖️ Legal Services',
                    'accounting': '📊 Accounting & Finance',
                    'consulting': '💼 Consulting',
                    'real_estate': '🏡 Real Estate',
                    'insurance': '🛡️ Insurance',
                    'healthcare': '🏥 Healthcare & Medical',
                    'portfolio': '🎨 Portfolio & Creative',
                    'photography': '📸 Photography',
                    'design': '✨ Design & Graphics',
                    'marketing': '📈 Marketing & Advertising',
                    'web_development': '💻 Web Development',
                    'retail': '🛍️ Retail Store',
                    'ecommerce': '🛒 E-commerce',
                    'restaurant': '🍽️ Restaurant & Food',
                    'fashion': '👗 Fashion & Clothing',
                    'beauty': '💄 Beauty & Wellness',
                    'technology': '💻 Technology & IT',
                    'education': '🎓 Education & Training',
                    'fitness': '💪 Fitness & Sports',
                    'nonprofit': '❤️ Non-profit & Community',
                    'other': '🏢 Other Business Type'
                };
                const displayText = businessTypeMap[projectData.business_type] || projectData.business_type.replace('_', ' ').toUpperCase();
                const businessTypeElement = document.getElementById('projectBusinessType');
                if (businessTypeElement) {
                    businessTypeElement.textContent = displayText;
                }

                // Show services section for all business types with dynamic content
                const servicesSection = document.getElementById('servicesSection');
                
                if (servicesSection && projectData.business_type) {
                    // Update services content based on business type
                    updateServicesContent(projectData.business_type);
                    // Update about content based on business type
                    updateAboutContent(projectData.business_type);
                    // Update contact content based on business type
                    updateContactContent(projectData.business_type);
                    
                    // Show the services section
                    servicesSection.style.display = 'block';
                    
                    // Show the contact section
                    const contactSection = document.getElementById('contactSection');
                    if (contactSection) {
                        contactSection.style.display = 'block';
                    }
                    
                    // Trigger animation
                    setTimeout(() => {
                        const serviceCards = servicesSection.querySelectorAll('.service-card');
                        serviceCards.forEach((card, index) => {
                            setTimeout(() => {
                                card.style.opacity = '0';
                                card.style.transform = 'translateY(30px)';
                                card.style.transition = 'all 0.6s ease';
                                setTimeout(() => {
                                    card.style.opacity = '1';
                                    card.style.transform = 'translateY(0)';
                                }, 100);
                            }, index * 150);
                        });
                    }, 300);
                }
            }
            
            // Update Website Type
            if (projectData.website_type) {
                const websiteTypeText = projectData.website_type === 'one_page' ? 'One Page Website' : 'Multi-Page Website';
                document.getElementById('projectWebsiteType').textContent = websiteTypeText;
            }

            // Legacy support for existing fields
            if (projectData.industry) {
                const industryElement = document.getElementById('projectIndustry');
                if (industryElement) {
                    industryElement.textContent = projectData.industry.replace('_', ' ').toUpperCase();
                }
            }
            if (projectData.services_count !== undefined) {
                const servicesElement = document.getElementById('projectServices');
                if (servicesElement) {
                    servicesElement.innerHTML = `<span class="badge bg-secondary">${projectData.services_count}</span>`;
                }
            }
            
            // Update contact details in preview sections
            updateContactDetails(projectData);
        }

        function updateContactDetails(businessData) {
            // Update contact details in the static preview section
            if (businessData.phone_number) {
                const phoneElement = document.getElementById('businessPhone');
                if (phoneElement) {
                    phoneElement.textContent = businessData.phone_number;
                }
            }

            if (businessData.business_email) {
                const emailElement = document.getElementById('businessEmail');
                if (emailElement) {
                    emailElement.textContent = businessData.business_email;
                }
            }

            if (businessData.whatsapp_number) {
                const whatsappElement = document.getElementById('businessWhatsApp');
                if (whatsappElement) {
                    whatsappElement.textContent = businessData.whatsapp_number;
                }
            }

            if (businessData.opening_times) {
                const hoursElement = document.getElementById('businessHours');
                if (hoursElement) {
                    // Format opening times with proper line breaks
                    const formattedHours = businessData.opening_times.replace(/\n/g, '<br>');
                    hoursElement.innerHTML = formattedHours;
                }
            }

            if (businessData.business_address) {
                const addressElement = document.getElementById('businessAddress');
                if (addressElement) {
                    const formattedAddress = businessData.business_address.replace(/\n/g, '<br>');
                    addressElement.innerHTML = formattedAddress;
                }

                // Also update map address
                const mapAddressElement = document.getElementById('mapAddress');
                if (mapAddressElement) {
                    mapAddressElement.textContent = businessData.business_address.split('\n')[0]; // First line only
                }
            }
        }

        function updateProgress(progress, currentStep) {
            // Update progress bar
            const progressBar = document.querySelector('.progress-bar');
            if (progressBar) {
                progressBar.style.width = progress + '%';
                progressBar.setAttribute('aria-valuenow', progress);
            }

            // Update step indicators
            updateStepIndicators(currentStep);
        }

        function updateStepIndicators(currentStep) {
            const stepMapping = {
                'welcome': 0,
                'business_name': 1,
                'industry_selection': 2,
                'services_selection': 3,
                'business_details': 4,
                'template_selection': 5,
                'content_generation': 6,
                'content_review': 7,
                'final_review': 8,
                'completion': 9
            };

            const currentStepIndex = stepMapping[currentStep] || 0;

            // Update step icons
            const steps = [
                'business-name', 'industry', 'services', 'details',
                'template', 'content', 'review', 'completion'
            ];

            steps.forEach((step, index) => {
                const stepElement = document.getElementById(`step-${step}`);
                if (stepElement) {
                    if (index < currentStepIndex) {
                        stepElement.className = 'fas fa-check-circle text-success me-2';
                    } else if (index === currentStepIndex) {
                        stepElement.className = 'fas fa-circle text-primary me-2';
                    } else {
                        stepElement.className = 'fas fa-circle text-muted me-2';
                    }
                }
            });
        }

        // Handle checkbox submission for services
        function submitSelectedServices() {
            const checkboxes = document.querySelectorAll('input[name="services"]:checked');
            const selectedServices = Array.from(checkboxes).map(cb => cb.value);

            if (selectedServices.length === 0) {
                alert('Please select at least one service, or type your services in the text box below.');
                return;
            }

            // Format the selected services as a message
            const servicesMessage = selectedServices.join(', ');

            // Send the message through the normal chat flow
            sendMessage(servicesMessage);
        }

        // Handle template selection
        function selectTemplate(templateNumber) {
            // Visual feedback - highlight selected template
            const cards = document.querySelectorAll('.template-card');
            cards.forEach(card => {
                card.style.borderColor = 'transparent';
                card.style.transform = 'none';
            });

            const selectedCard = document.querySelector(`.template-card:nth-child(${templateNumber})`);
            if (selectedCard) {
                selectedCard.style.borderColor = '#28a745';
                selectedCard.style.transform = 'translateY(-5px)';
                selectedCard.style.boxShadow = '0 8px 20px rgba(40,167,69,0.3)';
            }

            // Send template selection message
            setTimeout(() => {
                sendMessage(templateNumber.toString());
            }, 500);
        }

        // Handle template preview
        function previewTemplate(imageUrl, templateName) {
            // Create modal for template preview
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-eye me-2"></i>Template Preview: ${templateName}
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body text-center">
                            <img src="${imageUrl}" class="img-fluid rounded" alt="${templateName}" style="max-height: 70vh;">
                            <div class="mt-3">
                                <p class="text-muted">This is a preview of the ${templateName} template design.</p>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close Preview</button>
                            <button type="button" class="btn btn-primary" onclick="selectTemplateFromPreview('${templateName}')">
                                ✅ Choose This Template
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();

            // Remove modal when hidden
            modal.addEventListener('hidden.bs.modal', () => {
                modal.remove();
            });
        }

        // Select template from preview modal
        function selectTemplateFromPreview(templateName) {
            // Close any open modal
            const modal = document.querySelector('.modal.show');
            if (modal) {
                const bootstrapModal = bootstrap.Modal.getInstance(modal);
                bootstrapModal.hide();
            }

            // Find which template number this is and select it
            const cards = document.querySelectorAll('.template-card');
            cards.forEach((card, index) => {
                const cardTitle = card.querySelector('.card-title');
                if (cardTitle && cardTitle.textContent.includes(templateName)) {
                    selectTemplate(index + 1);
                }
            });
        }

        // Cookie helper function
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Handle Enter key in input
        messageInput.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                chatForm.dispatchEvent(new Event('submit'));
            }
        });

        // Initialize step indicators
        updateStepIndicators('{{ conversation.current_step }}');

        // Live Preview Functions
        let currentPreviewMode = 'desktop';

        function togglePreviewDevice(mode) {
            currentPreviewMode = mode;
            const frame = document.getElementById('websitePreviewFrame');
            const desktopBtn = document.getElementById('desktopBtn');
            const mobileBtn = document.getElementById('mobileBtn');

            if (mode === 'mobile') {
                frame.classList.add('mobile-view');
                desktopBtn.classList.remove('active');
                mobileBtn.classList.add('active');
            } else {
                frame.classList.remove('mobile-view');
                desktopBtn.classList.add('active');
                mobileBtn.classList.remove('active');
            }
        }

        function updatePreviewStep(stepName) {
            // Update step indicators in preview
            const steps = document.querySelectorAll('.step');
            steps.forEach(step => {
                step.classList.remove('active', 'completed');
            });

            const stepMap = {
                'business_info': 'step-business',
                'services': 'step-services',
                'template': 'step-template',
                'content': 'step-content'
            };

            const currentStep = document.getElementById(stepMap[stepName]);
            if (currentStep) {
                currentStep.classList.add('active');

                // Mark previous steps as completed
                const allSteps = ['step-business', 'step-services', 'step-template', 'step-content'];
                const currentIndex = allSteps.indexOf(stepMap[stepName]);
                for (let i = 0; i < currentIndex; i++) {
                    const prevStep = document.getElementById(allSteps[i]);
                    if (prevStep) {
                        prevStep.classList.add('completed');
                        prevStep.classList.remove('active');
                    }
                }
            }
        }

        function scrollToFooterInPreview() {
            // Scroll to footer in the preview iframe
            const previewFrame = document.getElementById('websitePreviewFrame');
            if (previewFrame && previewFrame.contentWindow) {
                try {
                    // Try to scroll to footer in the preview frame
                    const frameDocument = previewFrame.contentDocument || previewFrame.contentWindow.document;
                    const footer = frameDocument.querySelector('footer') || frameDocument.querySelector('.footer');
                    if (footer) {
                        footer.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        // If no footer found, scroll to bottom
                        previewFrame.contentWindow.scrollTo({
                            top: previewFrame.contentDocument.body.scrollHeight,
                            behavior: 'smooth'
                        });
                    }
                } catch (e) {
                    console.log('Cannot access iframe content due to CORS. Trying postMessage...');
                    // Send message to iframe to scroll to footer
                    previewFrame.contentWindow.postMessage({
                        action: 'scrollToFooter'
                    }, '*');
                }
            }
        }

        function generatePreviewHTML(businessData, templateData) {
            // Generate the actual website HTML based on business data and template
            const template = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${businessData.name || 'Your Business'}</title>
                    <style>
                        body { 
                            font-family: ${templateData.fontFamily || 'Arial, sans-serif'}; 
                            margin: 0; 
                            padding: 0;
                            color: ${templateData.textColor || '#333'};
                        }
                        .header {
                            background: ${templateData.primaryColor || '#007bff'};
                            color: white;
                            padding: 2rem;
                            text-align: center;
                        }
                        .content {
                            padding: 2rem;
                            max-width: 1200px;
                            margin: 0 auto;
                        }
                        .services {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                            gap: 1rem;
                            margin: 2rem 0;
                        }
                        .service-card {
                            background: ${templateData.cardBackground || '#f8f9fa'};
                            padding: 1.5rem;
                            border-radius: 8px;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        }
                        .loading { 
                            opacity: 0.7; 
                            position: relative;
                        }
                        .loading::after {
                            content: '';
                            position: absolute;
                            top: 0; left: 0; right: 0; bottom: 0;
                            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
                            animation: shimmer 2s infinite;
                        }
                        @keyframes shimmer {
                            0% { transform: translateX(-100%); }
                            100% { transform: translateX(100%); }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${businessData.name || 'Your Business Name'}</h1>
                        <p>${businessData.tagline || 'Professional services you can trust'}</p>
                    </div>
                    <div class="content">
                        <section class="about">
                            <h2>About Us</h2>
                            <p class="${!businessData.about ? 'loading' : ''}">${businessData.about || 'Content being generated...'}</p>
                        </section>
                        <section class="services">
                            <h2>Our Services</h2>
                            <div class="services">
                                ${(businessData.services || []).map(service => `
                                    <div class="service-card">
                                        <h3>${service.name || 'Service'}</h3>
                                        <p class="${!service.description ? 'loading' : ''}">${service.description || 'Description being generated...'}</p>
                                    </div>
                                `).join('') || '<div class="loading">Services being generated...</div>'}
                            </div>
                        </section>
                    </div>
                </body>
                </html>
            `;
            return template;
        }

        function updateLivePreview(businessData, templateData = {}) {
            const previewFrame = document.getElementById('websitePreviewFrame');
            const placeholder = document.getElementById('previewPlaceholder');

            // Always show preview (either with business data or default template)
            placeholder.style.display = 'none';
            previewFrame.style.display = 'block';

            if (businessData && businessData.name) {
                // Generate and load the preview HTML with business data
                const previewHTML = generatePreviewHTML(businessData, templateData);
                const blob = new Blob([previewHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                previewFrame.src = url;

                // Update preview title
                const previewTitle = document.getElementById('previewTitle');
                if (previewTitle) {
                    previewTitle.textContent = businessData.name;
                }
            } else {
                // Load default preview template
                previewFrame.src = '{% url "website_builder:default_preview" %}';

                // Update preview title
                const previewTitle = document.getElementById('previewTitle');
                if (previewTitle) {
                    previewTitle.textContent = 'Website Preview';
                }
            }
        }

        // Business Details Modal Handler
        function handleBusinessDetailsSubmission() {
            const submitBtn = document.getElementById('startBuildingBtn');
            if (submitBtn) {
                submitBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const form = document.getElementById('businessDetailsForm');
                    const formData = new FormData(form);
                    const businessData = {};
                    formData.forEach((value, key) => {
                        businessData[key] = value;
                    });
                    

                    
                    // Save business details to backend
                    const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || getCookie('csrftoken');
                    
                    fetch(`{% url 'website_builder:update_project_api' project.project_id %}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken
                        },
                        body: JSON.stringify({
                            business_name: businessData.business_name,
                            phone: businessData.phone_number,
                            business_email: businessData.business_email,
                            whatsapp_number: businessData.whatsapp_number,
                            opening_times: businessData.opening_times,
                            business_address: businessData.business_address,
                            industry: businessData.business_type,
                            website_type: businessData.website_type
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            console.log('Business details saved successfully:', data.message);
                        } else {
                            console.error('Failed to save business details:', data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error saving business details:', error);
                    });
                    
                    // Update the project information table immediately
                    updateProjectInfo({
                        business_name: businessData.business_name,
                        phone_number: businessData.phone_number, // Form field is phone_number, model field is phone
                        phone: businessData.phone_number, // Also update the phone field for model compatibility
                        business_email: businessData.business_email,
                        whatsapp_number: businessData.whatsapp_number,
                        opening_times: businessData.opening_times,
                        business_address: businessData.business_address,
                        business_type: businessData.business_type,
                        website_type: businessData.website_type
                    });
                    
                    // Update the preview title
                    const previewTitle = document.getElementById('previewTitle');
                    if (previewTitle && businessData.business_name) {
                        previewTitle.textContent = businessData.business_name + ' Preview';
                    }
                    
                    // Send business details to preview iframe for dynamic updates
                    const previewFrame = document.getElementById('websitePreviewFrame');
                    if (previewFrame && previewFrame.contentWindow) {
                        const businessContactData = {
                            business_name: businessData.business_name,
                            business_phone: businessData.phone_number,
                            business_email: businessData.business_email,
                            whatsapp_number: businessData.whatsapp_number,
                            business_address: businessData.business_address,
                            business_hours: businessData.opening_times || 'Mon-Fri: 9:00 AM - 6:00 PM<br>Sat: 10:00 AM - 4:00 PM'
                        };
                        
                        // Send message to iframe with business details
                        previewFrame.contentWindow.postMessage({
                            type: 'updateBusinessDetails',
                            businessData: businessContactData
                        }, '*');
                    }
                    
                    // Close the modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('websiteBuilderModal'));
                    if (modal) {
                        modal.hide();
                    }
                    
                    // Check if this is a new project (no business name was set before) or editing existing
                    const isNewProject = !document.getElementById('projectBusinessName')?.textContent || 
                                         document.getElementById('projectBusinessName')?.textContent === 'Not specified';
                    
                    if (isNewProject && businessData.business_name) {
                        // For new projects, send a message to start the building process
                        setTimeout(() => {
                            sendMessage(`My business name is ${businessData.business_name}. I have completed the business details form. Please help me choose a template and start building my website.`);
                        }, 500);
                    } else {
                        // For existing projects, just confirm the update
                        setTimeout(() => {
                            sendMessage(`I have updated my business details. The information should now be reflected across the website.`);
                        }, 500);
                    }
                });
            }
        }

        // Populate modal with existing data when opened for editing
        function populateBusinessDetailsModal() {
            const modal = document.getElementById('websiteBuilderModal');
            if (modal) {
                modal.addEventListener('show.bs.modal', function() {
                    // Get current values from the project information table
                    const businessName = document.getElementById('projectBusinessName')?.textContent;
                    const phoneNumber = document.getElementById('projectPhoneNumber')?.textContent;
                    const businessEmail = document.getElementById('projectBusinessEmail')?.textContent;
                    const whatsappNumber = document.getElementById('projectWhatsappNumber')?.textContent;
                    const openingTimes = document.getElementById('projectOpeningTimes')?.textContent;
                    const businessAddress = document.getElementById('projectBusinessAddress')?.textContent;
                    const businessType = document.getElementById('projectBusinessType')?.textContent;
                    const websiteType = document.getElementById('projectWebsiteType')?.textContent;
                    
                    // Populate form fields if values exist and are not "Not specified"
                    if (businessName && businessName !== 'Not specified') {
                        const nameField = document.getElementById('businessName');
                        if (nameField) nameField.value = businessName;
                    }
                    
                    if (phoneNumber && phoneNumber !== 'Not specified') {
                        const phoneField = document.getElementById('phoneNumber');
                        if (phoneField) phoneField.value = phoneNumber;
                    }
                    
                    if (businessEmail && businessEmail !== 'Not specified') {
                        const emailField = document.getElementById('businessEmail');
                        if (emailField) emailField.value = businessEmail;
                    }
                    
                    if (whatsappNumber && whatsappNumber !== 'Not specified') {
                        const whatsappField = document.getElementById('whatsappNumber');
                        if (whatsappField) whatsappField.value = whatsappNumber;
                    }
                    
                    if (openingTimes && openingTimes !== 'Not specified') {
                        // Parse and populate the interactive opening hours widget
                        populateOpeningHours(openingTimes);
                    }
                    
                    if (businessAddress && businessAddress !== 'Not specified') {
                        const addressField = document.getElementById('businessAddress');
                        if (addressField) addressField.value = businessAddress;
                    }
                    
                    // For business type, we need to find the matching option value
                    if (businessType && businessType !== 'Not specified') {
                        const typeField = document.getElementById('businessType');
                        if (typeField) {
                            // Try to find the option that matches the displayed text
                            const options = typeField.querySelectorAll('option');
                            options.forEach(option => {
                                if (option.textContent.includes(businessType.replace(/^[^\s]*\s/, ''))) {
                                    typeField.value = option.value;
                                }
                            });
                        }
                    }
                    
                    // For website type radio buttons
                    if (websiteType && websiteType !== 'Not specified') {
                        if (websiteType.includes('One Page')) {
                            const onePageRadio = document.getElementById('onePageSite');
                            if (onePageRadio) onePageRadio.checked = true;
                        } else if (websiteType.includes('Multi-Page')) {
                            const multiPageRadio = document.getElementById('multiPageSite');
                            if (multiPageRadio) multiPageRadio.checked = true;
                        }
                    }
                });
            }
        }

        // Update services content based on business type
        function updateServicesContent(businessType) {
            const servicesGrid = document.getElementById('servicesGrid');
            const servicesTitle = document.querySelector('#servicesSection h2');
            const servicesSubtitle = document.querySelector('#servicesSection p');
            
            if (!servicesGrid) return;
            
            // Also update about section
            updateAboutContent(businessType);
            
            // Define services for each business type
            const businessServices = {
                'automotive': {
                    title: 'Our Automotive Services',
                    subtitle: 'Professional automotive solutions you can trust for all your vehicle needs',
                    services: [
                        { icon: 'fas fa-car', name: 'General Auto Repair', desc: 'Complete vehicle diagnostics, maintenance, and repair services', gradient: 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)' },
                        { icon: 'fas fa-cog', name: 'Engine Diagnostics', desc: 'Advanced computer diagnostics and engine performance analysis', gradient: 'linear-gradient(135deg, #fd7e14 0%, #e8590c 100%)' },
                        { icon: 'fas fa-tools', name: 'Brake & Suspension', desc: 'Brake system service, suspension repair, and safety inspections', gradient: 'linear-gradient(135deg, #28a745 0%, #1e7e34 100%)' },
                        { icon: 'fas fa-oil-can', name: 'Oil Change & Fluids', desc: 'Regular maintenance, oil changes, and fluid replacements', gradient: 'linear-gradient(135deg, #007bff 0%, #0056b3 100%)' },
                        { icon: 'fas fa-battery-full', name: 'Electrical Systems', desc: 'Battery service, alternator repair, and electrical diagnostics', gradient: 'linear-gradient(135deg, #ffc107 0%, #e0a800 100%)' },
                        { icon: 'fas fa-snowflake', name: 'A/C & Heating', desc: 'Climate control repair, A/C service, and heating system maintenance', gradient: 'linear-gradient(135deg, #17a2b8 0%, #117a8b 100%)' }
                    ]
                },
                'construction': {
                    title: 'Our Construction Services',
                    subtitle: 'Professional construction and renovation services for residential and commercial projects',
                    services: [
                        { icon: 'fas fa-hammer', name: 'General Construction', desc: 'Complete construction services from foundation to finishing', gradient: 'linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%)' },
                        { icon: 'fas fa-home', name: 'Home Renovation', desc: 'Kitchen, bathroom, and whole-home renovation projects', gradient: 'linear-gradient(135deg, #28a745 0%, #1e7e34 100%)' },
                        { icon: 'fas fa-paint-roller', name: 'Painting Services', desc: 'Interior and exterior painting with premium materials', gradient: 'linear-gradient(135deg, #fd7e14 0%, #e8590c 100%)' },
                        { icon: 'fas fa-wrench', name: 'Plumbing & HVAC', desc: 'Complete plumbing installation, repair, and HVAC services', gradient: 'linear-gradient(135deg, #007bff 0%, #0056b3 100%)' },
                        { icon: 'fas fa-bolt', name: 'Electrical Work', desc: 'Licensed electrical installation, wiring, and panel upgrades', gradient: 'linear-gradient(135deg, #ffc107 0%, #e0a800 100%)' },
                        { icon: 'fas fa-layer-group', name: 'Flooring & Tile', desc: 'Hardwood, tile, laminate, and carpet installation services', gradient: 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)' }
                    ]
                },
                'portfolio': {
                    title: 'Our Creative Services',
                    subtitle: 'Transform your vision into stunning visual reality with our professional creative services',
                    services: [
                        { icon: 'fas fa-palette', name: 'Graphic Design', desc: 'Logo design, branding, print materials, and digital graphics', gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' },
                        { icon: 'fas fa-globe', name: 'Web Design & Development', desc: 'Custom websites, UI/UX design, and responsive layouts', gradient: 'linear-gradient(135deg, #28a745 0%, #20c997 100%)' },
                        { icon: 'fas fa-camera', name: 'Photography', desc: 'Portrait, commercial, event, and product photography', gradient: 'linear-gradient(135deg, #ffc107 0%, #fd7e14 100%)' },
                        { icon: 'fas fa-video', name: 'Video Production', desc: 'Promotional videos, editing, animation, and motion graphics', gradient: 'linear-gradient(135deg, #dc3545 0%, #e91e63 100%)' },
                        { icon: 'fas fa-award', name: 'Brand Identity Design', desc: 'Complete branding packages, style guides, and corporate identity', gradient: 'linear-gradient(135deg, #6f42c1 0%, #495057 100%)' },
                        { icon: 'fas fa-lightbulb', name: 'Creative Consultation', desc: 'Creative direction, concept development, and visual strategy', gradient: 'linear-gradient(135deg, #17a2b8 0%, #138496 100%)' }
                    ]
                },
                'healthcare': {
                    title: 'Our Healthcare Services',
                    subtitle: 'Comprehensive healthcare services focused on your health and well-being',
                    services: [
                        { icon: 'fas fa-user-md', name: 'General Consultation', desc: 'Comprehensive health assessments and medical consultations', gradient: 'linear-gradient(135deg, #28a745 0%, #20c997 100%)' },
                        { icon: 'fas fa-heartbeat', name: 'Preventive Care', desc: 'Regular checkups, screenings, and preventive health programs', gradient: 'linear-gradient(135deg, #dc3545 0%, #e91e63 100%)' },
                        { icon: 'fas fa-pills', name: 'Treatment Services', desc: 'Medical treatment, prescription management, and follow-up care', gradient: 'linear-gradient(135deg, #007bff 0%, #6f42c1 100%)' },
                        { icon: 'fas fa-dumbbell', name: 'Wellness Programs', desc: 'Fitness programs, nutrition counseling, and lifestyle coaching', gradient: 'linear-gradient(135deg, #fd7e14 0%, #ffc107 100%)' },
                        { icon: 'fas fa-brain', name: 'Mental Health', desc: 'Counseling, therapy, and mental health support services', gradient: 'linear-gradient(135deg, #6f42c1 0%, #495057 100%)' },
                        { icon: 'fas fa-ambulance', name: 'Emergency Care', desc: 'Urgent care services and emergency medical support', gradient: 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)' }
                    ]
                },
                'restaurant': {
                    title: 'Our Culinary Services',
                    subtitle: 'Delicious dining experiences crafted with passion and the finest ingredients',
                    services: [
                        { icon: 'fas fa-utensils', name: 'Fine Dining', desc: 'Exquisite dining experience with carefully curated menus', gradient: 'linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%)' },
                        { icon: 'fas fa-pizza-slice', name: 'Casual Dining', desc: 'Comfortable atmosphere with delicious, everyday favorites', gradient: 'linear-gradient(135deg, #fd7e14 0%, #e8590c 100%)' },
                        { icon: 'fas fa-shipping-fast', name: 'Takeout & Delivery', desc: 'Convenient ordering with fast delivery to your location', gradient: 'linear-gradient(135deg, #28a745 0%, #1e7e34 100%)' },
                        { icon: 'fas fa-glass-cheers', name: 'Catering Services', desc: 'Professional catering for events, parties, and special occasions', gradient: 'linear-gradient(135deg, #17a2b8 0%, #117a8b 100%)' },
                        { icon: 'fas fa-birthday-cake', name: 'Special Events', desc: 'Custom menus and service for weddings and celebrations', gradient: 'linear-gradient(135deg, #e83e8c 0%, #d91a72 100%)' },
                        { icon: 'fas fa-wine-glass-alt', name: 'Bar & Beverages', desc: 'Craft cocktails, wine selection, and beverage pairings', gradient: 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)' }
                    ]
                }
            };
            
            // Default services for unknown business types
            const defaultServices = {
                title: 'Our Professional Services',
                subtitle: 'Quality services tailored to meet your specific business needs',
                services: [
                    { icon: 'fas fa-briefcase', name: 'Consultation Services', desc: 'Professional consultation and strategic business advice', gradient: 'linear-gradient(135deg, #007bff 0%, #0056b3 100%)' },
                    { icon: 'fas fa-cogs', name: 'Custom Solutions', desc: 'Tailored solutions designed specifically for your requirements', gradient: 'linear-gradient(135deg, #28a745 0%, #1e7e34 100%)' },
                    { icon: 'fas fa-users', name: 'Client Support', desc: 'Dedicated support and assistance throughout our partnership', gradient: 'linear-gradient(135deg, #6f42c1 0%, #495057 100%)' },
                    { icon: 'fas fa-chart-line', name: 'Performance Analysis', desc: 'Data-driven analysis and performance improvement strategies', gradient: 'linear-gradient(135deg, #ffc107 0%, #e0a800 100%)' },
                    { icon: 'fas fa-handshake', name: 'Partnership Services', desc: 'Long-term partnerships and collaborative business relationships', gradient: 'linear-gradient(135deg, #17a2b8 0%, #117a8b 100%)' },
                    { icon: 'fas fa-star', name: 'Premium Support', desc: 'Premium-level service with priority support and maintenance', gradient: 'linear-gradient(135deg, #fd7e14 0%, #e8590c 100%)' }
                ]
            };
            
            // Get services for the business type or use defaults
            const serviceData = businessServices[businessType] || defaultServices;
            
            // Update title and subtitle
            if (servicesTitle) {
                servicesTitle.textContent = serviceData.title;
            }
            if (servicesSubtitle) {
                servicesSubtitle.textContent = serviceData.subtitle;
            }
            
            // Generate services HTML
            const servicesHTML = serviceData.services.map(function(service) {
                return '<div style="width: 100%;">' +
                    '<div class="service-card" style="background: white; padding: 1.5rem; border-radius: 15px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border: 2px solid transparent; transition: all 0.3s ease; height: 100%;">' +
                        '<div class="service-icon" style="width: 60px; height: 60px; background: ' + service.gradient + '; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem;">' +
                            '<i class="' + service.icon + '"></i>' +
                        '</div>' +
                        '<h5 style="color: #333; margin-bottom: 0.8rem; font-weight: 600; font-size: 1.1rem;">' + service.name + '</h5>' +
                        '<p style="color: #666; font-size: 0.9rem; line-height: 1.5; margin-bottom: 0;">' + service.desc + '</p>' +
                    '</div>' +
                '</div>';
            }).join('');
            
            // Update the services grid and ensure it has proper CSS Grid properties
            servicesGrid.innerHTML = servicesHTML;
            servicesGrid.style.display = 'grid';
            servicesGrid.style.gridTemplateColumns = '1fr 1fr';
            servicesGrid.style.gap = '1rem';
            servicesGrid.style.width = '100%';
        }

        // Update about content based on business type
        function updateAboutContent(businessType) {
            const aboutTitle = document.getElementById('aboutTitle');
            const aboutDescription = document.getElementById('aboutDescription');
            const aboutMission = document.getElementById('aboutMission');
            const aboutYears = document.getElementById('aboutYears');
            const aboutClients = document.getElementById('aboutClients');
            const aboutIcon = document.getElementById('aboutIcon');
            const aboutImageText = document.getElementById('aboutImageText');
            const aboutImageContainer = document.getElementById('aboutImageContainer');
            
            // Define about content for each business type
            const aboutContent = {
                'automotive': {
                    title: 'About Our Automotive Shop',
                    description: 'We are a trusted automotive service center with certified technicians and state-of-the-art equipment. Our team is committed to keeping your vehicle running safely and efficiently with honest, reliable service.',
                    mission: 'Our mission is to provide exceptional automotive care that keeps you on the road with confidence. We believe in transparent pricing, quality workmanship, and building lasting relationships with our customers.',
                    years: '15+',
                    clients: '2000+',
                    icon: 'fas fa-car',
                    imageText: 'Professional Auto Care',
                    gradient: 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)'
                },
                'construction': {
                    title: 'About Our Construction Company',
                    description: 'We are a full-service construction company specializing in residential and commercial projects. From new builds to renovations, our experienced team delivers quality craftsmanship on time and within budget.',
                    mission: 'Our mission is to build lasting relationships through exceptional construction services. We take pride in turning your vision into reality with attention to detail and unwavering commitment to quality.',
                    years: '20+',
                    clients: '800+',
                    icon: 'fas fa-hard-hat',
                    imageText: 'Quality Construction',
                    gradient: 'linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%)'
                },
                'healthcare': {
                    title: 'About Our Healthcare Practice',
                    description: 'We are a dedicated healthcare practice focused on providing comprehensive, compassionate care to our patients. Our experienced medical professionals are committed to your health and well-being.',
                    mission: 'Our mission is to deliver exceptional healthcare services that promote wellness and improve quality of life. We believe in treating each patient with dignity, respect, and personalized attention.',
                    years: '12+',
                    clients: '5000+',
                    icon: 'fas fa-user-md',
                    imageText: 'Compassionate Care',
                    gradient: 'linear-gradient(135deg, #28a745 0%, #20c997 100%)'
                },
                'restaurant': {
                    title: 'About Our Restaurant',
                    description: 'We are a family-owned restaurant passionate about creating memorable dining experiences. Using fresh, locally-sourced ingredients, we craft delicious meals that bring people together.',
                    mission: 'Our mission is to provide exceptional food and service in a warm, welcoming atmosphere. We believe that great meals create lasting memories and bring communities together.',
                    years: '8+',
                    clients: '10000+',
                    icon: 'fas fa-utensils',
                    imageText: 'Culinary Excellence',
                    gradient: 'linear-gradient(135deg, #fd7e14 0%, #e8590c 100%)'
                },
                'portfolio': {
                    title: 'About Our Creative Studio',
                    description: 'We are a creative studio specializing in innovative design solutions that help brands tell their story. Our talented team combines artistic vision with strategic thinking to deliver impactful results.',
                    mission: 'Our mission is to transform ideas into powerful visual experiences that connect brands with their audiences. We believe in the power of creativity to inspire, engage, and drive success.',
                    years: '10+',
                    clients: '300+',
                    icon: 'fas fa-palette',
                    imageText: 'Creative Innovation',
                    gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
                }
            };
            
            // Default content for unknown business types
            const defaultContent = {
                title: 'About Our Company',
                description: 'We are a professional business dedicated to providing exceptional services to our clients. With years of experience in our industry, we have built a reputation for quality, reliability, and customer satisfaction.',
                mission: 'Our mission is to deliver outstanding results that exceed expectations while maintaining the highest standards of professionalism and integrity in everything we do.',
                years: '10+',
                clients: '500+',
                icon: 'fas fa-building',
                imageText: 'Professional Excellence',
                gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
            };
            
            // Get content for the business type or use defaults
            const content = aboutContent[businessType] || defaultContent;
            
            // Update about section elements
            if (aboutTitle) aboutTitle.textContent = content.title;
            if (aboutDescription) aboutDescription.textContent = content.description;
            if (aboutMission) aboutMission.textContent = content.mission;
            if (aboutYears) aboutYears.textContent = content.years;
            if (aboutClients) aboutClients.textContent = content.clients;
            if (aboutIcon) aboutIcon.className = content.icon;
            if (aboutImageText) aboutImageText.textContent = content.imageText;
            if (aboutImageContainer) aboutImageContainer.style.background = content.gradient;
        }

        // Update contact content based on business type
        function updateContactContent(businessType) {
            const contactTitle = document.getElementById('contactTitle');
            const contactSubtitle = document.getElementById('contactSubtitle');
            const formTitle = document.getElementById('formTitle');
            const serviceLabel = document.getElementById('serviceLabel');
            const serviceOption1 = document.getElementById('serviceOption1');
            const serviceOption2 = document.getElementById('serviceOption2');
            const serviceOption3 = document.getElementById('serviceOption3');
            const businessAddress = document.getElementById('businessAddress');
            const businessPhone = document.getElementById('businessPhone');
            const businessEmail = document.getElementById('businessEmail');
            const businessHours = document.getElementById('businessHours');
            const mapTitle = document.getElementById('mapTitle');
            const mapAddress = document.getElementById('mapAddress');
            
            // Define contact content for each business type
            const contactContent = {
                'automotive': {
                    title: 'Schedule Your Service',
                    subtitle: 'Get your vehicle serviced by certified professionals. Contact us today for a free estimate!',
                    formTitle: 'Book Your Appointment',
                    serviceLabel: 'Service Type',
                    serviceOptions: ['Oil Change', 'Brake Repair', 'Engine Diagnostics'],
                    address: '456 Auto Service Blvd<br>Mechanic City, ST 54321',
                    phone: '(555) CAR-CARE',
                    email: 'service@autoshop.com',
                    hours: 'Mon-Fri: 7:00 AM - 6:00 PM<br>Sat: 8:00 AM - 4:00 PM<br>Sun: Emergency Only',
                    mapTitle: 'Visit Our Shop',
                    mapAddress: '456 Auto Service Blvd, Mechanic City, ST'
                },
                'construction': {
                    title: 'Start Your Project',
                    subtitle: 'Ready to build your dream? Get a free consultation and quote from our expert team!',
                    formTitle: 'Request a Quote',
                    serviceLabel: 'Project Type',
                    serviceOptions: ['New Construction', 'Renovation', 'Commercial Project'],
                    address: '789 Builder\'s Way<br>Construction City, ST 67890',
                    phone: '(555) BUILD-IT',
                    email: 'projects@constructco.com',
                    hours: 'Mon-Fri: 6:00 AM - 5:00 PM<br>Sat: 7:00 AM - 3:00 PM<br>Sun: Closed',
                    mapTitle: 'Find Our Office',
                    mapAddress: '789 Builder\'s Way, Construction City, ST'
                },
                'healthcare': {
                    title: 'Book Your Appointment',
                    subtitle: 'Your health is our priority. Schedule your appointment with our experienced medical team.',
                    formTitle: 'Schedule Appointment',
                    serviceLabel: 'Appointment Type',
                    serviceOptions: ['General Checkup', 'Specialist Consultation', 'Emergency Care'],
                    address: '321 Health Plaza<br>Medical Center, ST 13579',
                    phone: '(555) HEALTH-1',
                    email: 'appointments@healthcenter.com',
                    hours: 'Mon-Fri: 8:00 AM - 6:00 PM<br>Sat: 9:00 AM - 2:00 PM<br>Sun: Emergency Only',
                    mapTitle: 'Visit Our Clinic',
                    mapAddress: '321 Health Plaza, Medical Center, ST'
                },
                'restaurant': {
                    title: 'Make a Reservation',
                    subtitle: 'Experience exceptional dining! Reserve your table or place an order for pickup.',
                    formTitle: 'Table Reservation',
                    serviceLabel: 'Service Type',
                    serviceOptions: ['Dine-In Reservation', 'Takeout Order', 'Catering Inquiry'],
                    address: '654 Culinary Street<br>Food District, ST 24680',
                    phone: '(555) FOOD-YUM',
                    email: 'reservations@restaurant.com',
                    hours: 'Mon-Thu: 11:00 AM - 10:00 PM<br>Fri-Sat: 11:00 AM - 11:00 PM<br>Sun: 12:00 PM - 9:00 PM',
                    mapTitle: 'Find Our Restaurant',
                    mapAddress: '654 Culinary Street, Food District, ST'
                },
                'portfolio': {
                    title: 'Start Your Project',
                    subtitle: 'Let\'s bring your creative vision to life! Contact us to discuss your next project.',
                    formTitle: 'Project Inquiry',
                    serviceLabel: 'Project Type',
                    serviceOptions: ['Web Design', 'Branding', 'Marketing Campaign'],
                    address: '987 Creative Ave<br>Design District, ST 97531',
                    phone: '(555) CREATE-1',
                    email: 'hello@creativestudio.com',
                    hours: 'Mon-Fri: 9:00 AM - 6:00 PM<br>Sat: 10:00 AM - 4:00 PM<br>Sun: By Appointment',
                    mapTitle: 'Visit Our Studio',
                    mapAddress: '987 Creative Ave, Design District, ST'
                }
            };
            
            // Default content for unknown business types
            const defaultContent = {
                title: 'Get In Touch',
                subtitle: 'Ready to work with us? Contact us today for more information!',
                formTitle: 'Send us a Message',
                serviceLabel: 'Service Needed',
                serviceOptions: ['Consultation', 'Free Quote', 'General Inquiry'],
                address: '123 Business Street<br>City, State 12345',
                phone: '(555) 123-4567',
                email: 'info@business.com',
                hours: 'Mon-Fri: 9:00 AM - 6:00 PM<br>Sat: 9:00 AM - 4:00 PM<br>Sun: Closed',
                mapTitle: 'Find Our Location',
                mapAddress: '123 Business Street, City, State'
            };
            
            // Get content for the business type or use defaults
            const content = contactContent[businessType] || defaultContent;
            
            // Update contact section elements
            if (contactTitle) contactTitle.textContent = content.title;
            if (contactSubtitle) contactSubtitle.textContent = content.subtitle;
            if (formTitle) formTitle.textContent = content.formTitle;
            if (serviceLabel) serviceLabel.textContent = content.serviceLabel;
            if (serviceOption1) serviceOption1.textContent = content.serviceOptions[0];
            if (serviceOption2) serviceOption2.textContent = content.serviceOptions[1];
            if (serviceOption3) serviceOption3.textContent = content.serviceOptions[2];
            if (businessAddress) businessAddress.innerHTML = content.address;
            if (businessPhone) businessPhone.textContent = content.phone;
            if (businessEmail) businessEmail.textContent = content.email;
            if (businessHours) businessHours.innerHTML = content.hours;
            if (mapTitle) mapTitle.textContent = content.mapTitle;
            if (mapAddress) mapAddress.textContent = content.mapAddress;
        }

        function initializeServicesSection() {
            // Check if there's existing business type data and show services section accordingly
            const businessTypeElement = document.getElementById('projectBusinessType');
            if (businessTypeElement) {
                const currentText = businessTypeElement.textContent;
                // Extract business type from display text (remove emoji and format)
                let businessType = 'other';
                if (currentText.includes('Automotive')) businessType = 'automotive';
                else if (currentText.includes('Construction')) businessType = 'construction';
                else if (currentText.includes('Portfolio')) businessType = 'portfolio';
                else if (currentText.includes('Healthcare')) businessType = 'healthcare';
                else if (currentText.includes('Restaurant')) businessType = 'restaurant';
                else if (currentText.includes('Retail')) businessType = 'retail';
                else if (currentText.includes('Plumbing')) businessType = 'construction'; // Use construction services for plumbing
                else if (currentText.includes('Legal')) businessType = 'other';
                else if (currentText.includes('Accounting')) businessType = 'other';
                else if (currentText.includes('Real Estate')) businessType = 'other';
                else if (currentText.includes('Photography')) businessType = 'portfolio';
                else if (currentText.includes('Design')) businessType = 'portfolio';
                else if (currentText.includes('Marketing')) businessType = 'portfolio';
                else if (currentText.includes('Web Development')) businessType = 'portfolio';
                else if (currentText.includes('Technology')) businessType = 'other';
                else if (currentText.includes('Education')) businessType = 'other';
                
                // Update and show services section for all business types
                updateServicesContent(businessType);
                // Update about section for all business types
                updateAboutContent(businessType);
                // Update contact section for all business types
                updateContactContent(businessType);
                const servicesSection = document.getElementById('servicesSection');
                const contactSection = document.getElementById('contactSection');
                if (servicesSection && businessType) {
                    servicesSection.style.display = 'block';
                }
                if (contactSection && businessType) {
                    contactSection.style.display = 'block';
                }
            }
        }

        // Initialize preview on page load
        document.addEventListener('DOMContentLoaded', function () {
            togglePreviewDevice('desktop'); // Set default to desktop view
            
            // Initialize business details modal handlers
            handleBusinessDetailsSubmission();
            populateBusinessDetailsModal();

            // Initialize services section visibility
            initializeServicesSection();

            // Initialize with any existing project data
            {% if project %}
            const initialData = {
                name: '{{ project.business_name|default:"" }}',
                services: {{ project.services|default:"[]"|safe }},
                about: '{{ project.business_description|default:"" }}'
            };
            if (initialData.name) {
                updateLivePreview(initialData);
            }
            {% endif %}
            
            // Initialize navigation scroll functionality
            window.scrollToSection = function(sectionId) {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            };
            
            // Initialize business details modal functionality
            handleBusinessDetailsSubmission();
            populateBusinessDetailsModal();
        });

        // Function to populate opening hours widget from existing text
        function populateOpeningHours(hoursText) {
            if (!hoursText || hoursText === 'Not specified') return;
            
            // Clear all days first
            const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
            days.forEach(day => {
                document.getElementById(day + '-active').checked = false;
                toggleDay(day);
            });
            
            try {
                // Parse common formats
                const lines = hoursText.split('\n').map(line => line.trim()).filter(line => line);
                
                lines.forEach(line => {
                    // Try to parse different formats
                    if (line.toLowerCase().includes('mon') && line.toLowerCase().includes('fri')) {
                        // Monday-Friday format
                        const timeMatch = line.match(/(\d{1,2}):(\d{2})\s*(AM|PM)?\s*-\s*(\d{1,2}):(\d{2})\s*(AM|PM)?/i);
                        if (timeMatch) {
                            const openTime = convertTo24Hour(timeMatch[1], timeMatch[2], timeMatch[3]);
                            const closeTime = convertTo24Hour(timeMatch[4], timeMatch[5], timeMatch[6]);
                            
                            ['mon', 'tue', 'wed', 'thu', 'fri'].forEach(day => {
                                document.getElementById(day + '-active').checked = true;
                                document.getElementById(day + '-open').value = openTime;
                                document.getElementById(day + '-close').value = closeTime;
                                toggleDay(day);
                            });
                        }
                    } else if (line.toLowerCase().includes('sat') || line.toLowerCase().includes('sun')) {
                        // Weekend formats
                        const timeMatch = line.match(/(\d{1,2}):(\d{2})\s*(AM|PM)?\s*-\s*(\d{1,2}):(\d{2})\s*(AM|PM)?/i);
                        if (timeMatch) {
                            const openTime = convertTo24Hour(timeMatch[1], timeMatch[2], timeMatch[3]);
                            const closeTime = convertTo24Hour(timeMatch[4], timeMatch[5], timeMatch[6]);
                            
                            if (line.toLowerCase().includes('sat')) {
                                document.getElementById('sat-active').checked = true;
                                document.getElementById('sat-open').value = openTime;
                                document.getElementById('sat-close').value = closeTime;
                                toggleDay('sat');
                            }
                            if (line.toLowerCase().includes('sun')) {
                                document.getElementById('sun-active').checked = true;
                                document.getElementById('sun-open').value = openTime;
                                document.getElementById('sun-close').value = closeTime;
                                toggleDay('sun');
                            }
                        }
                    }
                });
                
                // Update preview after parsing
                if (typeof updateHoursPreview === 'function') {
                    updateHoursPreview();
                }
                
            } catch (error) {
                console.log('Could not parse opening hours:', error);
                // Fallback: just set the text in the hidden field
                document.getElementById('openingTimes').value = hoursText;
            }
        }

        function convertTo24Hour(hour, minute, ampm) {
            let h = parseInt(hour);
            const m = minute.padStart(2, '0');
            
            if (ampm && ampm.toLowerCase() === 'pm' && h !== 12) {
                h += 12;
            } else if (ampm && ampm.toLowerCase() === 'am' && h === 12) {
                h = 0;
            }
            
            return h.toString().padStart(2, '0') + ':' + m;
        }

        document.addEventListener('DOMContentLoaded', function() {
        });
    </script>
</body>

</html>