{% load static %}
<!-- Fixed WhatsApp Assistant - Bottom Right -->
<div id="whatsapp-assistant" class="whatsapp-assistant">
    <!-- Chat Button (Always Visible) -->
    <div class="chat-button" onclick="toggleWhatsAppChat()">
        <i class="bi bi-whatsapp"></i>
        <span class="status-dot"></span>
    </div>
    
    <!-- Chat Window (Initially Hidden) -->
    <div id="chat-window" class="chat-window">
        <!-- Chat Header -->
        <div class="chat-header">
            <div class="chat-avatar">
                <i class="bi bi-person-circle"></i>
            </div>
            <div class="chat-info">
                <h6>{{ company_name|default:"JustCodeWorks.EU" }}</h6>
                <p>
                    <span class="online-indicator"></span>
                    Online now
                </p>
            </div>
            <button class="close-chat" onclick="toggleWhatsAppChat()">
                <i class="bi bi-x"></i>
            </button>
        </div>
        
        <!-- Chat Messages -->
        <div class="chat-messages">
            <div class="message bot-message">
                <div class="message-avatar">
                    <i class="bi bi-robot"></i>
                </div>
                <div class="message-content">
                    <p>Hi there! üëã</p>
                    <p>How can we help you today?</p>
                    <span class="message-time">Just now</span>
                </div>
            </div>
            
            <div class="quick-replies">
                <button class="quick-reply" onclick="selectQuickReply('I need a website')">
                    üåê I need a website
                </button>
                <button class="quick-reply" onclick="selectQuickReply('SEO services')">
                    üìà SEO services
                </button>
                <button class="quick-reply" onclick="openQuoteModal(); toggleWhatsAppChat();">
                    ‚ö° Snelle Offerte
                </button>
                <button class="quick-reply" onclick="selectQuickReply('Get a quote')">
                    üí∞ Uitgebreide Offerte
                </button>
                <button class="quick-reply" onclick="selectQuickReply('Support')">
                    üõ†Ô∏è Support
                </button>
            </div>
        </div>
        
        <!-- Chat Input -->
        <div class="chat-input">
            <input type="text" 
                   id="chat-message-input" 
                   placeholder="Type your message..." 
                   onkeypress="handleChatInput(event)">
            <button onclick="sendChatMessage()">
                <i class="bi bi-send"></i>
            </button>
        </div>
        
        <!-- WhatsApp CTA -->
        <div class="whatsapp-cta">
            <button class="btn btn-success w-100" onclick="openWhatsApp()">
                <i class="bi bi-whatsapp me-2"></i>
                Continue on WhatsApp
            </button>
        </div>
    </div>
</div>

<script>
// WhatsApp Assistant JavaScript
let chatOpen = false;

function toggleWhatsAppChat() {
    const chatWindow = document.getElementById('chat-window');
    const chatButton = document.querySelector('.chat-button');
    
    chatOpen = !chatOpen;
    
    if (chatOpen) {
        chatWindow.classList.add('active');
        chatButton.classList.add('active');
    } else {
        chatWindow.classList.remove('active');
        chatButton.classList.remove('active');
    }
}

function selectQuickReply(message) {
    // Add user message
    addChatMessage(message, 'user');
    
    // Remove quick replies
    document.querySelector('.quick-replies').style.display = 'none';
    
    // Add bot response after delay
    setTimeout(() => {
        let response = getBotResponse(message);
        addChatMessage(response, 'bot');
    }, 1000);
}

function addChatMessage(message, sender) {
    const messagesContainer = document.querySelector('.chat-messages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}-message`;
    
    const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    
    if (sender === 'user') {
        messageDiv.innerHTML = `
            <div class="message-content">
                <p>${message}</p>
                <span class="message-time">${time}</span>
            </div>
        `;
    } else {
        messageDiv.innerHTML = `
            <div class="message-avatar">
                <i class="bi bi-robot"></i>
            </div>
            <div class="message-content">
                <p>${message}</p>
                <span class="message-time">${time}</span>
            </div>
        `;
    }
    
    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function getBotResponse(userMessage) {
    const responses = {
        'I need a website': 'Great! We specialize in custom website design and development. Would you like to schedule a consultation to discuss your project?',
        'SEO services': 'Perfect! Our SEO services help businesses rank higher in search results. We offer comprehensive SEO audits and optimization strategies.',
        'Get a quote': 'I\'d be happy to help you get a quote! Could you tell me what type of service you\'re interested in?',
        'Support': 'We\'re here to help! What do you need assistance with today?'
    };
    
    return responses[userMessage] || 'Thank you for your message! One of our team members will get back to you shortly.';
}

function handleChatInput(event) {
    if (event.key === 'Enter') {
        sendChatMessage();
    }
}

function sendChatMessage() {
    const input = document.getElementById('chat-message-input');
    const message = input.value.trim();
    
    if (message) {
        addChatMessage(message, 'user');
        input.value = '';
        
        // Add bot response after delay
        setTimeout(() => {
            let response = 'Thank you for your message! We\'ll get back to you as soon as possible. In the meantime, feel free to continue the conversation on WhatsApp.';
            addChatMessage(response, 'bot');
        }, 1000);
    }
}

function openWhatsApp() {
    const phone = '{{ sidebar_contact.whatsapp_number|default:"+420123456789" }}';
    const message = encodeURIComponent('Hi! I\'m interested in your services.');
    const whatsappUrl = `https://wa.me/${phone.replace(/[^0-9]/g, '')}?text=${message}`;
    window.open(whatsappUrl, '_blank');
}

// Close chat when clicking outside
document.addEventListener('click', function(event) {
    const assistant = document.getElementById('whatsapp-assistant');
    if (chatOpen && !assistant.contains(event.target)) {
        toggleWhatsAppChat();
    }
});
</script>